# 版本升级测试

为了 Module 在升级 Minor 版本后，不会对升级 Minor 版本的用户造成破坏性变更，我们需要对 Module 进行版本升级测试。

版本升级测试的逻辑也已经在 E2E 测试帮助方法当中实现了：[github.com/lonegunmanb/terraform-module-test-helper](https://github.com/lonegunmanb/terraform-module-test-helper)，下面讲讲的原理。

首先会通过 Github API 获取最新的发布版号，然后在 `/tmp/` 下 checkout 一份最新发布版的 Module 代码，使用 Terratest 执行该版本，随后修改环境变量 `MODULE_SOURCE`，这将对应我们在[演示代码](../%E6%BC%94%E7%A4%BA%E4%BB%A3%E7%A0%81.md#overridetftplt)中提到的模板文件中使用的环境变量，从而可以通过 `override.tf` 文件修改 Module 的 `source`，只想当前测试的版本，然后重新执行 `terraform init` 以及 `terraform plan`，观察生成的计划中是否包含变更，即可判定版本更新是否会造成“意外”的变更。

理想状态下，用户升级 Minor 版本，在不修改传入的 `variable` 的前提下，是不应该观察到任何变更的。